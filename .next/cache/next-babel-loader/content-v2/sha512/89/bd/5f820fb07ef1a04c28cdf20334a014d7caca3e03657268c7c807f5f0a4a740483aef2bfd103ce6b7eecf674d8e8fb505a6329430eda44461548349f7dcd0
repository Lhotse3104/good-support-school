{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"/Users/murayamasatoshi/work/good-support-school/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"/Users/murayamasatoshi/work/good-support-school/src/pages/prefectures.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { useRouter } from \"next/router\";\nimport prefectures from '../styles/Prefectures.module.css';\nimport Table from 'react-bootstrap/Table';\nimport { firebaseDb } from '../../firebase/index.js';\n\nvar Prefectures = function Prefectures() {\n  _s();\n\n  var _useState = useState([]),\n      cityData = _useState[0],\n      setCityData = _useState[1];\n\n  var _useState2 = useState([]),\n      activeState = _useState2[0],\n      setActiveState = _useState2[1];\n\n  var router = useRouter(); // パスパラメータから値を取得\n\n  var preCode = router.query.preCode;\n  var prefCode = preCode;\n  var localStgId = 'good-district' + preCode;\n\n  var setGoodBad = function setGoodBad(index, type) {\n    var copyData = _toConsumableArray(cityData);\n\n    var copyState = _toConsumableArray(activeState);\n\n    copyData[index][type] = copyState[index][type + 'active'] ? copyData[index][type] - 1 : copyData[index][type] + 1;\n    copyState[index][type + 'active'] = !copyState[index][type + 'active'];\n    firebaseDb.ref('citydata/' + prefCode).set(copyData);\n    setCityData(copyData);\n    localStorage.setItem(localStgId, JSON.stringify(copyState));\n    setActiveState(copyState);\n  };\n\n  var handleLike = function handleLike(index) {\n    setGoodBad(index, 'good');\n\n    if (activeState[index].badactive) {\n      setGoodBad(index, 'bad');\n    }\n  };\n\n  var handleDislike = function handleDislike(index) {\n    setGoodBad(index, 'bad');\n\n    if (activeState[index].goodactive) {\n      setGoodBad(index, 'good');\n    }\n  };\n\n  useEffect(function () {\n    // const f = async() =>{\n    // \tconst data = await requestCity(preCode)\n    // \tconsole.log(data)\n    // }\n    firebaseDb.ref('citydata/' + prefCode).on(\"value\", function (data) {\n      if (data) {\n        //console.log(localStorage.getItem(localStgId))\n        if (localStorage.getItem(localStgId) === null) {\n          var actives = data.val().map(function () {\n            return {\n              goodactive: false,\n              badactive: false\n            };\n          });\n          setActiveState(actives);\n        } else {\n          setActiveState(JSON.parse(localStorage.getItem(localStgId)));\n        }\n\n        setCityData(data.val());\n      }\n    });\n  }, []); // const requestCity = async (preCode) => {\n  // \ttry{\n  // \t\tconst res = await axios('https://opendata.resas-portal.go.jp/api/v1/cities?prefCode='+preCode,{\n  // \t\t\theaders:{ 'X-API-KEY': 'CVOkbeaEzBIagVaey2hxjWizntOlmHM3ZtC8OwFd'}\n  // \t\t})\n  //     setCityData(res.data)\n  // \t}\n  // \tcatch (error) {    \n  // \t\tconsole.log(\"error!!\")\n  // \t}\n  // }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: prefectures.container,\n    children: /*#__PURE__*/_jsxDEV(Table, {\n      className: prefectures.table,\n      striped: true,\n      bordered: true,\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          className: prefectures.header,\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u5E02\\u753A\\u6751\\u30B3\\u30FC\\u30C9\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 7\n          }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"\\u652F\\u5E81\\u5E02\\u90E1\\u533A\\u753A\\u6751\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 7\n          }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"good\\uD83D\\uDC4D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 7\n          }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"bad\\uD83D\\uDC4E\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 7\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 6\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 5\n      }, _this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: cityData.map(function (city, index) {\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            className: prefectures.header,\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: city.citycode\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 98,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: city.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: activeState[index].goodactive ? prefectures.iconbutton_on : prefectures.iconbutton_off,\n                onClick: function onClick() {\n                  return handleLike(index);\n                },\n                children: \"\\uD83D\\uDC4D\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 11\n              }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: activeState[index].goodactive ? prefectures.count_good : prefectures.count_off,\n                children: '' + city.good\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 102,\n                columnNumber: 11\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: activeState[index].badactive ? prefectures.iconbutton_on : prefectures.iconbutton_off,\n                onClick: function onClick() {\n                  return handleDislike(index);\n                },\n                children: \"\\uD83D\\uDC4E\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 104,\n                columnNumber: 11\n              }, _this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: activeState[index].badactive ? prefectures.count_bad : prefectures.count_off,\n                children: '' + city.bad\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 105,\n                columnNumber: 11\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 103,\n              columnNumber: 19\n            }, _this)]\n          }, index, true, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 17\n          }, _this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 5\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 4\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Prefectures, \"iexut/yu8pjK6XbhIGNAAkACoA8=\", false, function () {\n  return [useRouter];\n});\n\n_c = Prefectures;\n\nPrefectures.getInitialProps = function (_ref) {\n  var query = _ref.query;\n  return {\n    query: query\n  };\n};\n\nexport default Prefectures;\n\nvar _c;\n\n$RefreshReg$(_c, \"Prefectures\");","map":{"version":3,"sources":["/Users/murayamasatoshi/work/good-support-school/src/pages/prefectures.tsx"],"names":["React","useEffect","useState","useRouter","prefectures","Table","firebaseDb","Prefectures","cityData","setCityData","activeState","setActiveState","router","preCode","query","prefCode","localStgId","setGoodBad","index","type","copyData","copyState","ref","set","localStorage","setItem","JSON","stringify","handleLike","badactive","handleDislike","goodactive","on","data","getItem","actives","val","map","parse","container","table","header","city","citycode","name","iconbutton_on","iconbutton_off","count_good","count_off","good","count_bad","bad","getInitialProps"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\nimport { useRouter } from \"next/router\"\nimport prefectures from '../styles/Prefectures.module.css'\nimport Table from 'react-bootstrap/Table'\nimport axios from 'axios'\nimport { firebaseDb } from '../../firebase/index.js'\n\nconst Prefectures = () => {\n  const [cityData, setCityData] = useState([])\n\tconst [activeState, setActiveState] = useState([])\n\tconst router = useRouter();\n\t// パスパラメータから値を取得\n\tconst { preCode } = router.query;\n\tconst prefCode:string = preCode as string\n\tconst localStgId:string = 'good-district' + preCode\n\n\tconst setGoodBad = (index:number, type:string) => {\n\t\tconst copyData = [...cityData]\n\t\tconst copyState = [...activeState]\n\t\tcopyData[index][type] = copyState[index][type+'active'] ? copyData[index][type] - 1 : copyData[index][type] + 1\n\t\tcopyState[index][type+'active'] =  !copyState[index][type+'active']\n\t\tfirebaseDb.ref('citydata/'+prefCode).set(copyData);\n\t\tsetCityData(copyData)\n\t\tlocalStorage.setItem(localStgId, JSON.stringify(copyState));\n\t\tsetActiveState(copyState)\n\t}\n\n\tconst handleLike = (index:number) => {\n\t\tsetGoodBad(index,'good')\n    if (activeState[index].badactive) {\n      setGoodBad(index,'bad')\n    }\n  }\n\n  const handleDislike = (index:number) => {\n\t\tsetGoodBad(index,'bad')\n    if (activeState[index].goodactive) {\n      setGoodBad(index,'good')\n    }\n  }\n\n\n\tuseEffect(() => {\n\t\t// const f = async() =>{\n\t\t// \tconst data = await requestCity(preCode)\n\t\t// \tconsole.log(data)\n\t\t// }\n\t\tfirebaseDb.ref('citydata/'+prefCode).on(\"value\", (data)=> {\n\t\t\tif (data) {\n\t\t\t\t//console.log(localStorage.getItem(localStgId))\n\t\t\t\tif ((localStorage.getItem(localStgId) === null)) {\n\t\t\t\t\tconst actives = data.val().map(()=>{\n\t\t\t\t\t\treturn(\n\t\t\t\t\t\t\t{goodactive:false, badactive:false}\n\t\t\t\t\t\t)\n\t\t\t\t\t})\n\t\t\t\t\tsetActiveState(actives)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsetActiveState(JSON.parse(localStorage.getItem(localStgId)))\n\t\t\t\t}\n\t\t\t\tsetCityData(data.val())\n\t\t\t}\n\t\t});\n\t},[])\n\n\n\t// const requestCity = async (preCode) => {\n\t// \ttry{\n\t// \t\tconst res = await axios('https://opendata.resas-portal.go.jp/api/v1/cities?prefCode='+preCode,{\n\t// \t\t\theaders:{ 'X-API-KEY': 'CVOkbeaEzBIagVaey2hxjWizntOlmHM3ZtC8OwFd'}\n\t// \t\t})\n  //     setCityData(res.data)\n\t// \t}\n\t// \tcatch (error) {    \n\t// \t\tconsole.log(\"error!!\")\n\t// \t}\n\t// }\n\n  return (\n    <div className={prefectures.container}>\n\t\t\t<Table className={prefectures.table} striped bordered>\n\t\t\t\t<thead>\n\t\t\t\t\t<tr className={prefectures.header}>\n\t\t\t\t\t\t<th>市町村コード</th>\n\t\t\t\t\t\t<th>支庁市郡区町村</th>\n\t\t\t\t\t\t<th>good👍</th>\n\t\t\t\t\t\t<th>bad👎</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n          {\n            cityData.map((city, index)=>\n            {\n              return(\n                <tr key={index} className={prefectures.header}>\n                  <th>{city.citycode}</th>\n                  <th>{city.name}</th>\n                  <th>\n\t\t\t\t\t\t\t\t\t\t<button className={activeState[index].goodactive ? prefectures.iconbutton_on : prefectures.iconbutton_off} onClick={()=>handleLike(index)}>👍</button>\n\t\t\t\t\t\t\t\t\t\t<span className={activeState[index].goodactive ? prefectures.count_good : prefectures.count_off}>{''+city.good}</span></th>\n                  <th>\n\t\t\t\t\t\t\t\t\t\t<button className={activeState[index].badactive ? prefectures.iconbutton_on : prefectures.iconbutton_off} onClick={()=>handleDislike(index)}>👎</button>\n\t\t\t\t\t\t\t\t\t\t<span className={activeState[index].badactive ? prefectures.count_bad : prefectures.count_off}>{''+city.bad}</span>\n\t\t\t\t\t\t\t\t\t</th>\n                </tr>\n              )\n            })\n          }\n\t\t\t\t</tbody>\n\t\t\t</Table>\n    </div>\n  )\n}\n\nPrefectures.getInitialProps = ({query}) => {\n  return {\n\t\tquery\n  }\n}\n\nexport default Prefectures"]},"metadata":{},"sourceType":"module"}